from pwn import *
import os

#stage1
stage1=[b'A']*100
stage1[ord("A")]=b"\x00"
stage1[ord("B")]=b"\x20\x0a\x0d"
stage1[ord("C")]=b"9898" #for stage 5

#stage2
fd1,data1=os.pipe()
fd2,data2=os.pipe()
os.write(data1,b"\x00\x0a\x00\xff")
os.write(data2,b"\x00\x0a\x02\xff")

#stage3
env={b"\xde\xad\xbe\xef":b"\xca\xfe\xba\xbe"}

#stage4
f=open("\x0a","w")
f.write("\x00\x00\x00\x00")
f.close()

#calling process
p=process(executable="/home/input2/input",argv=stage1,stdin=fd1,stderr=fd2,env=env)

#stage 5
msg=remote('localhost',9898)
msg.sendline(b"\xde\xad\xbe\xef")

#gain shell
p.interactive()